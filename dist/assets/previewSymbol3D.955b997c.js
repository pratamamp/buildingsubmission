import{n6 as $,s as _,n7 as G,n8 as P,n9 as J,c8 as T,y as w,f as F,t as S,na as K,c_ as Q,nb as W,kS as V,nc as X,nd as Y,r as M,ne as B,mp as ss,hB as es,eI as as,me as ts,nf as ns,ng as rs,nh as ls,ni as os,nj as is,nk as cs,mq as ps,nl as E,nm as hs}from"./index.52935b46.js";import{resolveWebStyleSymbol as us}from"./webStyleSymbolUtils.20127335.js";import"./devEnvironmentUtils.8c6e6b72.js";const L=$.size,D=$.maxSize,Z=$.maxOutlineSize,H=$.lineWidth,q=$.tallSymbolWidth,ms=_.getLogger("esri.symbols.support.previewSymbol3D");function z(s){const e=s.outline,n=M(s.material)?s.material.color:null,a=M(n)?n.toHex():null;if(S(e)||"pattern"in e&&M(e.pattern)&&e.pattern.type==="style"&&e.pattern.style==="none")return s.type==="fill"&&a==="#ffffff"?{color:"#bdc3c7",width:.75}:null;const t=w(e.size)||0;return{color:"rgba("+(M(e.color)?e.color.toRgba():"255,255,255,1")+")",width:Math.min(t,Z),style:"pattern"in e&&M(e.pattern)&&e.pattern.type==="style"?B(e.pattern.style):null,join:"butt",cap:"patternCap"in e?e.patternCap:"butt"}}function fs(s,e){const n=e&&e.resource,a=n&&n.href;if(s.thumbnail&&s.thumbnail.url)return Promise.resolve(s.thumbnail.url);if(a&&e.type!=="object")return Promise.resolve(ss(s,e));const t=T("esri/images/Legend/legend3dsymboldefault.png");return s.styleOrigin&&(s.styleOrigin.styleName||s.styleOrigin.styleUrl)?us(s.styleOrigin,{portal:s.styleOrigin.portal},"webRef").catch(r=>r).then(r=>{var l;return((l=r==null?void 0:r.thumbnail)==null?void 0:l.url)||t}):Promise.resolve(t)}function I(s,e=1){const n=s.a,a=es(s),t=a.h,r=a.s/e,l=100-(100-a.v)/e,{r:p,g:y,b:u}=as({h:t,s:r,v:l});return[p,y,u,n]}function C(s){return s.type==="water"?S(s.color)?null:s.color:S(s.material)||S(s.material.color)?null:s.material.color}function i(s,e=0){const n=C(s);if(!n){if(s.type==="fill")return null;const t=G.r,r=P(t,e);return[r,r,r,100]}const a=n.toRgba();for(let t=0;t<3;t++)a[t]=P(a[t],e);return a}async function ys(s,e){const n=s.style;return n==="none"?null:{type:"pattern",x:0,y:0,src:await J(T(`esri/symbols/patterns/${n}.png`),e.toCss(!0)),width:5,height:5}}function N(s){return s.outline?z(s):{color:"rgba(0, 0, 0, 1)",width:1.5}}function U(s,e){const n=C(s);if(!n)return null;let a="rgba(";return a+=P(n.r,e)+",",a+=P(n.g,e)+",",a+=P(n.b,e)+",",a+n.a+");"}function R(s,e){const n=U(s,e);return n?"pattern"in s&&M(s.pattern)&&s.pattern.type==="style"&&s.pattern.style==="none"?null:{color:n,width:Math.min(s.size?w(s.size):.75,Z),style:"pattern"in s&&M(s.pattern)&&s.pattern.type==="style"?B(s.pattern.style):null,cap:"cap"in s?s.cap:null,join:"join"in s?s.join==="miter"?w(2):s.join:null}:{}}function O(s,e,n){const a=.75*n;return{type:"linear",x1:a?.25*a:0,y1:a?.5*a:0,x2:a||4,y2:a?.5*a:4,colors:[{color:s,offset:0},{color:e,offset:1}]}}function ds(s){const e=s.depth,n=s.height,a=s.width;return a&&e&&n&&a===e&&a<n}function bs(s,e,n){const a=[];if(!s)return a;switch(s.type){case"icon":{const l=e,p=e;switch(s.resource&&s.resource.primitive||ps){case"circle":a.push({shape:{type:"circle",cx:0,cy:0,r:.5*e},fill:i(s,0),stroke:z(s)});break;case"square":a.push({shape:{type:"path",path:[{command:"M",values:[0,p]},{command:"L",values:[0,0]},{command:"L",values:[l,0]},{command:"L",values:[l,p]},{command:"Z",values:[]}]},fill:i(s,0),stroke:z(s)});break;case"triangle":a.push({shape:{type:"path",path:[{command:"M",values:[0,p]},{command:"L",values:[.5*l,0]},{command:"L",values:[l,p]},{command:"Z",values:[]}]},fill:i(s,0),stroke:z(s)});break;case"cross":a.push({shape:{type:"path",path:[{command:"M",values:[.5*l,0]},{command:"L",values:[.5*l,p]},{command:"M",values:[0,.5*p]},{command:"L",values:[l,.5*p]}]},stroke:N(s)});break;case"x":a.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[l,p]},{command:"M",values:[l,0]},{command:"L",values:[0,p]}]},stroke:N(s)});break;case"kite":a.push({shape:{type:"path",path:[{command:"M",values:[0,.5*p]},{command:"L",values:[.5*l,0]},{command:"L",values:[l,.5*p]},{command:"L",values:[.5*l,p]},{command:"Z",values:[]}]},fill:i(s,0),stroke:z(s)})}break}case"object":switch(s.resource&&s.resource.primitive||ts){case"cone":{const t=O(i(s,0),i(s,-.6),n?q:e),r=cs(e,n);a.push({shape:r[0],fill:t}),a.push({shape:r[1],fill:t});break}case"inverted-cone":{const t=i(s,0),r=O(t,i(s,-.6),e),l=is(e);a.push({shape:l[0],fill:r}),a.push({shape:l[1],fill:t});break}case"cube":{const t=os(e,n);a.push({shape:t[0],fill:i(s,0)}),a.push({shape:t[1],fill:i(s,-.3)}),a.push({shape:t[2],fill:i(s,-.5)});break}case"cylinder":{const t=O(i(s,0),i(s,-.6),n?q:e),r=ls(e,n);a.push({shape:r[0],fill:t}),a.push({shape:r[1],fill:t}),a.push({shape:r[2],fill:i(s,0)});break}case"diamond":{const t=rs(e);a.push({shape:t[0],fill:i(s,-.3)}),a.push({shape:t[1],fill:i(s,0)}),a.push({shape:t[2],fill:i(s,-.3)}),a.push({shape:t[3],fill:i(s,-.7)});break}case"sphere":{const t=O(i(s,0),i(s,-.6));t.x1=0,t.y1=0,t.x2=.25*e,t.y2=.25*e,a.push({shape:{type:"circle",cx:0,cy:0,r:.5*e},fill:t});break}case"tetrahedron":{const t=ns(e);a.push({shape:t[0],fill:i(s,-.3)}),a.push({shape:t[1],fill:i(s,0)}),a.push({shape:t[2],fill:i(s,-.6)});break}}break}return a}function A(s){const e=typeof(s==null?void 0:s.size)=="number"?s==null?void 0:s.size:null;return e?w(e):null}function gs(s){return s.type==="icon"?"multiply":"tint"}function ks(s,e){const n=A(e),a=e&&e.maxSize?w(e.maxSize):null,t=e&&e.disableUpsampling,r=s.symbolLayers,l=[];let p=0,y=0;const u=r.getItemAt(r.length-1);let d;return u&&u.type==="icon"&&(d=u.size&&w(u.size)),r.forEach(f=>{var v;if(f.type!=="icon"&&f.type!=="object")return;const c=f.type==="icon"?f.size&&w(f.size):0,h=n||c?Math.ceil(Math.min(n||c,a||D)):L;if(f&&f.resource&&f.resource.href){const o=fs(s,f).then(m=>{const b=f.get("material.color"),g=gs(f);return K(m,h,b,g,t)}).then(m=>{const b=m.width,g=m.height;return p=Math.max(p,b),y=Math.max(y,g),[{shape:{type:"image",x:0,y:0,width:b,height:g,src:m.url},fill:null,stroke:null}]});l.push(o)}else{let o=h;f.type==="icon"&&d&&n&&(o=h*(c/d));const m=(e==null?void 0:e.symbolConfig)==="tall"||((v=e==null?void 0:e.symbolConfig)==null?void 0:v.isTall)||f.type==="object"&&ds(f);p=Math.max(p,m?q:o),y=Math.max(y,o),l.push(Promise.resolve(bs(f,o,m)))}}),Q(l).then(f=>{const c=[];return f.forEach(h=>{h.value?c.push(h.value):h.error&&ms.warn("error while building swatchInfo!",h.error)}),W(c,[p,y],{node:e&&e.node,scale:!1,opacity:e&&e.opacity})})}function vs(s,e){const n=s.symbolLayers,a=[],t=V(s),r=A(e),l=(e&&e.maxSize?w(e.maxSize):null)||Z;let p,y=0,u=0;return n.forEach((d,f)=>{if(!d||d.type!=="line"&&d.type!=="path")return;const c=[];switch(d.type){case"line":{const h=R(d,0);if(S(h))break;const v=h&&h.width||0;f===0&&(p=v);const o=Math.min(r||v,l),m=f===0?o:r?o*(v/p):o,b=m>H/2?2*m:H;u=Math.max(u,m),y=Math.max(y,b),h.width=m,c.push({shape:{type:"path",path:[{command:"M",values:[0,.5*u]},{command:"L",values:[y,.5*u]}]},stroke:h});break}case"path":{const h=Math.min(r||L,l),v=i(d,0),o=i(d,-.2),m=U(d,-.4),b=m?{color:m,width:1}:{};if(d.profile==="quad"){const g=d.width,k=d.height,x=X(g&&k?g/k:1,k===0,g===0),j={...b,join:"bevel"};c.push({shape:x[0],fill:o,stroke:j}),c.push({shape:x[1],fill:o,stroke:j}),c.push({shape:x[2],fill:v,stroke:j})}else c.push({shape:E.pathSymbol3DLayer[0],fill:o,stroke:b}),c.push({shape:E.pathSymbol3DLayer[1],fill:v,stroke:b});u=Math.max(u,h),y=u}}a.push(c)}),Promise.resolve(W(a,[y,u],{node:e&&e.node,scale:t,opacity:e&&e.opacity}))}async function ws(s,e){const n=s.type==="mesh-3d",a=s.symbolLayers,t=A(e),r=e&&e.maxSize?w(e.maxSize):null,l=t||L,p=[];let y=0,u=0,d=!1;for(let f=0;f<a.length;f++){const c=a.getItemAt(f),h=[];if(n&&c.type!=="fill")continue;const v=E.fill[0];switch(c.type){case"fill":{const o=z(c),m=Math.min(l,r||D);y=Math.max(y,m),u=Math.max(u,m),d=!0;let b=i(c,0);const g="pattern"in c&&c.pattern,k=C(c);!n&&M(g)&&g.type==="style"&&g.style!=="solid"&&k&&(b=await ys(g,k)),h.push({shape:v,fill:b,stroke:o});break}case"line":{const o=R(c,0);if(S(o))break;const m={stroke:o,shape:v};y=Math.max(y,L),u=Math.max(u,L),h.push(m);break}case"extrude":{const o={join:"round",width:1,...R(c,-.4)},m=i(c,0),b=i(c,-.2),g=Math.min(l,r||D),k=Y(g);o.width=1,h.push({shape:k[0],fill:b,stroke:o}),h.push({shape:k[1],fill:b,stroke:o}),h.push({shape:k[2],fill:m,stroke:o});const x=L,j=.7*L+.5*g;y=Math.max(y,x),u=Math.max(u,j);break}case"water":{const o=C(c),m=I(o),b=I(o,2),g=I(o,3),k=hs();d=!0,h.push({shape:k[0],fill:m}),h.push({shape:k[1],fill:b}),h.push({shape:k[2],fill:g});const x=Math.min(l,r||D);y=Math.max(y,x),u=Math.max(u,x);break}}p.push(h)}return W(p,[y,u],{node:e&&e.node,scale:d,opacity:e&&e.opacity})}function zs(s,e){if(s.symbolLayers.length===0)return Promise.reject(new F("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));switch(s.type){case"point-3d":return ks(s,e);case"line-3d":return vs(s,e);case"polygon-3d":case"mesh-3d":return ws(s,e)}return Promise.reject(new F("symbolPreview: swatchInfo3D","symbol not supported."))}export{ys as getPatternDescriptor,A as getSizeFromOptions,i as getSymbolLayerFill,zs as previewSymbol3D};
