import{n6 as C,nq as S,nr as x,nb as D,bc as I}from"./index.52935b46.js";import{CIMSymbolRasterizer as v}from"./CIMSymbolRasterizer.598fa6c8.js";import"./cimAnalyzer.8ff78478.js";import"./CIMSymbolHelper.ae274396.js";import"./BidiEngine.ec67919b.js";import"./floatRGBA.5328f61e.js";import"./enums.05a6ea95.js";import"./alignmentUtils.63b4d661.js";import"./definitions.6dca4f7b.js";import"./number.08b65821.js";import"./GeometryUtils.814cb798.js";import"./callExpressionWithFeature.30f2ad17.js";import"./Rasterizer.2859baa8.js";const V=new v(null,!0),O=C.maxSize;async function B(t,e={}){const{size:s,maxSize:y,node:h,opacity:f}=e,g=e.cimOptions||e,{feature:w,fieldMap:b,geometryType:M,style:z}=g,u=S(t),d=typeof s=="number"?s:null,i=Math.min(d!=null?d:u,y!=null?y:I(O));i!==u&&(t=t.clone(),x(t,i,{preserveOutlineWidth:!0}));let r=3;t&&t.data&&t.data.symbol&&t.data.symbol.type!=="CIMPointSymbol"&&(r=1);const c=await V.rasterizeCIMSymbolAsync(t,w,b,M,{scaleFactor:r,style:z}),l=document.createElement("canvas");l.width=c.imageData.width,l.height=c.imageData.height,l.getContext("2d").putImageData(c.imageData,0,0);let n=l.width/r,a=l.height/r;if(s!=null&&((e==null?void 0:e.scale)==null||(e==null?void 0:e.scale))){const o=n/a;n=o<=1?Math.ceil(i*o):i,a=o<=1?i:Math.ceil(i/o)}const m=new Image(n,a);m.src=l.toDataURL(),f!=null&&(m.style.opacity=`${f}`);let p=m;if(e.effectView!=null){const o={shape:{type:"image",x:0,y:0,width:n,height:a,src:m.src},fill:null,stroke:null,offset:[0,0]};p=D([[o]],[n,a],{effectView:e.effectView})}return h&&h.appendChild(p),p}export{B as previewCIMSymbol};
