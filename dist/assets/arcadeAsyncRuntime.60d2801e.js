import{y as we,O as he,N as de,P as Ee,o as ge,r as me,f as ye,S as Ne,p as ve,u as Ie,I as Te,m as Se,b as p,d as v,a as ie,e as be,s as Re}from"./arcadeUtils.3ece5147.js";import{i8 as V,hW as T,ih as A,aP as Oe,iQ as m,iR as D,ic as u,iS as S,iT as _,ig as L,iv as j,hY as g,i7 as C,ib as x,iD as U,iK as se,hX as O,i2 as w,dw as $,i4 as b,iM as Ae,id as B,iN as Ue,is as Ce,iq as xe,iO as ee,i5 as Me,a8 as Fe,ar as Pe,dn as De,dm as Le,cE as ke,iL as _e}from"./index.52935b46.js";import{registerFunctions as je}from"./geomasync.18bfa0ce.js";import"./geometryEngineAsync.d24b32f6.js";function ne(n){return n&&typeof n.then=="function"}const Y=100;async function Z(n,e){const r=[];for(let t=0;t<e.arguments.length;t++)r.push(await c(n,e.arguments[t]));return r}async function N(n,e,r){return e.preparsed===!0?r(n,null,e.arguments):r(n,e,await Z(n,e))}async function F(n,e,r){if(e.preparsed===!0){const a=r(n,null,e.arguments);return ne(a),a}const t=r(n,e,await Z(n,e));return ne(t),t}async function c(n,e,r){if(e.breakpoint&&r!==!0)return await e.breakpoint(),c(n,e,!0);switch(e.type){case"VariableDeclarator":return en(n,e);case"VariableDeclaration":return le(n,e,0);case"BlockStatement":return Je(n,e);case"FunctionDeclaration":return $e(n,e);case"ReturnStatement":return Ke(n,e);case"IfStatement":return Xe(n,e);case"ExpressionStatement":return Qe(n,e);case"UpdateExpression":return We(n,e);case"AssignmentExpression":return Ze(n,e);case"ForStatement":return Ge(n,e);case"ForInStatement":return He(n,e);case"BreakStatement":return S;case"EmptyStatement":return u;case"ContinueStatement":return _;case"TemplateElement":return cn(n,e);case"TemplateLiteral":return ln(n,e);case"Identifier":return Q(n,e);case"MemberExpression":return nn(n,e);case"Literal":return e.value;case"CallExpression":return sn(n,e);case"UnaryExpression":return rn(n,e);case"BinaryExpression":return an(n,e);case"LogicalExpression":return on(n,e);case"ArrayExpression":return tn(n,e);case"ObjectExpression":return Ye(n,e);case"Property":return Ve(n,e);default:throw new Error(p(e,"RUNTIME","UNREOGNISED"))}}async function Ye(n,e){const r=[];for(let o=0;o<e.properties.length;o++)r[o]=await c(n,e.properties[o]);const t={};for(let o=0;o<r.length;o++){const i=r[o];if(j(i.value))throw new Error("Illegal Argument");if(g(i.key)===!1)throw new Error("Illegal Argument");i.value===u?t[i.key.toString()]=null:t[i.key.toString()]=i.value}const a=new v(t);return a.immutable=!1,a}async function Ve(n,e){const r=await c(n,e.value);return e.key.type==="Identifier"?{key:e.key.name,value:r}:{key:await c(n,e.key),value:r}}async function re(n,e,r){const t=await c(n,e.body);return r.lastAction=t,r.lastAction===S||r.lastAction instanceof m?(r.testResult=!1,r):(e.update!==null&&await c(n,e.update),r)}async function Be(n,e,r){if(e.test!==null){const t=await c(n,e.test);if(n.abortSignal.aborted===!0)throw new Error("Cancelled");if(r.testResult=t,r.testResult===!1)return r;if(r.testResult!==!0)throw new Error(p(e,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION"));return re(n,e,r)}return re(n,e,r)}function k(n,e,r,t,a,o){try{Be(n,e,r).then(()=>{try{r.testResult===!0?++o>Y?(o=0,setTimeout(()=>{k(n,e,r,t,a,o)},0)):k(n,e,r,t,a,o):r.lastAction instanceof m?t(r.lastAction):t(u)}catch(i){a(i)}},i=>{a(i)})}catch(i){a(i)}}function Ge(n,e){try{return e.init!==null?c(n,e.init).then(()=>new Promise((r,t)=>{k(n,e,{testResult:!0,lastAction:u},a=>{r(a)},a=>{t(a)},0)})):new Promise((r,t)=>{k(n,e,{testResult:!0,lastAction:u},a=>{r(a)},a=>{t(a)},0)})}catch(r){return Promise.reject(r)}}function G(n,e,r,t,a,o,i,s,l,f){try{if(t<=o)return void s(u);a.value=i==="k"?r[o]:o,c(n,e.body).then(h=>{try{h instanceof m?s(h):h===S?s(u):++f>Y?(f=0,setTimeout(()=>{G(n,e,r,t,a,o+1,i,s,l,f)},0)):G(n,e,r,t,a,o+1,i,s,l,f)}catch(d){l(d)}},h=>{l(h)})}catch(h){l(h)}}function z(n,e,r,t,a,o,i,s,l){try{if(r.length()<=a)return void i(u);t.value=o==="k"?r.get(a):a,c(n,e.body).then(f=>{f instanceof m?i(f):f===S?i(u):++l>Y?(l=0,setTimeout(()=>{z(n,e,r,t,a+1,o,i,s,l)},0)):z(n,e,r,t,a+1,o,i,s,l)},f=>{s(f)})}catch(f){s(f)}}function q(n,e,r,t,a,o){try{if(o===void 0&&(o="i"),r.length===0)return void t.resolve(u);G(n,e,r,r.length,a,0,o,i=>{t.resolve(i)},i=>{t.reject(i)},0)}catch(i){t.reject(i)}}function ze(n,e,r,t,a,o){try{if(o===void 0&&(o="i"),r.length===0)return void t.resolve(u);z(n,e,r,a,0,o,i=>{t.resolve(i)},i=>{t.reject(i)},0)}catch(i){t.reject(i)}}function qe(n,e,r,t,a){try{q(n,e,r.keys(),t,a,"k")}catch(o){t.reject(o)}}function H(n,e,r,t,a,o,i,s){try{n.next().then(l=>{try{if(l===null)o(u);else{const f=ie.createFromGraphicLikeObject(l.geometry,l.attributes,t);f._underlyingGraphic=l,a.value=f,c(e,r.body).then(h=>{try{h===S?o(u):h instanceof m?o(h):++s>Y?(s=0,setTimeout(()=>{H(n,e,r,t,a,o,i,s)},0)):H(n,e,r,t,a,o,i,s)}catch(d){i(d)}},h=>{i(h)})}}catch(f){i(f)}},l=>{i(l)})}catch(l){i(l)}}async function He(n,e){return new Promise((r,t)=>{c(n,e.right).then(a=>{try{let o=null;o=e.left.type==="VariableDeclaration"?c(n,e.left):Promise.resolve(),o.then(()=>{try{let i="";if(e.left.type==="VariableDeclaration"){const l=e.left.declarations[0].id;l.type==="Identifier"&&(i=l.name)}else e.left.type==="Identifier"&&(i=e.left.name);if(!i)throw new Error(p(e,"RUNTIME","INVALIDVARIABLE"));i=i.toLowerCase();let s=null;if(n.localScope!==null&&n.localScope[i]!==void 0&&(s=n.localScope[i]),s===null&&n.globalScope[i]!==void 0&&(s=n.globalScope[i]),s===null)return void t(new Error(p(e,"RUNTIME","VARIABLENOTDECLARED")));C(a)||g(a)?q(n,e,a,{reject:t,resolve:r},s):x(a)?ze(n,e,a,{reject:t,resolve:r},s):a instanceof v||U(a)?qe(n,e,a,{reject:t,resolve:r},s):se(a)?H(a.iterator(n.abortSignal),n,e,a,s,l=>{r(l)},l=>{t(l)},0):q(n,e,[],{reject:t,resolve:r},s)}catch(i){t(i)}},t)}catch(o){t(o)}},t)})}async function We(n,e){const r=e.argument;if(r.type==="MemberExpression"){const o={t:null},i=await c(n,r.object);let s=null;o.t=i,r.computed===!0?s=await c(n,r.property):r.property.type==="Identifier"&&(s=r.property.name);const l=o.t;let f;if(C(l)){if(!O(s))throw new Error("Invalid Parameter");if(s<0&&(s=l.length+s),s<0||s>=l.length)throw new Error("Assignment outside of array bounds");f=w(l[s]),l[s]=e.operator==="++"?f+1:f-1}else if(l instanceof v){if(g(s)===!1)throw new Error("Dictionary accessor must be a string");if(l.hasField(s)!==!0)throw new Error("Invalid Parameter");f=w(l.field(s)),l.setField(s,e.operator==="++"?f+1:f-1)}else{if(!U(l))throw x(l)?new Error("Array is Immutable"):new Error("Invalid Parameter");if(g(s)===!1)throw new Error("Feature accessor must be a string");if(l.hasField(s)!==!0)throw new Error("Invalid Parameter");f=w(l.field(s)),l.setField(s,e.operator==="++"?f+1:f-1)}return e.prefix===!1?f:e.operator==="++"?f+1:f-1}const t=e.argument.type==="Identifier"?e.argument.name.toLowerCase():"";if(!t)throw new Error("Invalid identifier");let a;if(n.localScope!==null&&n.localScope[t]!==void 0)return a=w(n.localScope[t].value),n.localScope[t]={value:e.operator==="++"?a+1:a-1,valueset:!0,node:e},e.prefix===!1?a:e.operator==="++"?a+1:a-1;if(n.globalScope[t]!==void 0)return a=w(n.globalScope[t].value),n.globalScope[t]={value:e.operator==="++"?a+1:a-1,valueset:!0,node:e},e.prefix===!1?a:e.operator==="++"?a+1:a-1;throw new Error("Variable not recognised")}function I(n,e,r,t){switch(e){case"=":return n===u?null:n;case"/=":return w(r)/w(n);case"*=":return w(r)*w(n);case"-=":return w(r)-w(n);case"+=":return g(r)||g(n)?b(r)+b(n):w(r)+w(n);case"%=":return w(r)%w(n);default:throw new Error(p(t,"RUNTIME","OPERATORNOTRECOGNISED"))}}async function Ze(n,e){const r=e.left;if(r.type==="MemberExpression"){const a=await c(n,e.right),o=await c(n,r.object);let i=null;if(r.computed===!0)i=await c(n,r.property);else{if(r.property.type!=="Identifier")throw new Error("Expected computed or identifier for assignemnt target");i=r.property.name}if(C(o)){if(!O(i))throw new Error("Invalid Parameter");if(i<0&&(i=o.length+i),i<0||i>o.length)throw new Error("Assignment outside of array bounds");if(i===o.length){if(e.operator!=="=")throw new Error("Invalid Parameter");o[i]=I(a,e.operator,o[i],e)}else o[i]=I(a,e.operator,o[i],e)}else if(o instanceof v){if(g(i)===!1)throw new Error("Dictionary accessor must be a string");if(o.hasField(i)===!0)o.setField(i,I(a,e.operator,o.field(i),e));else{if(e.operator!=="=")throw new Error("Invalid Parameter");o.setField(i,I(a,e.operator,null,e))}}else{if(!U(o))throw x(o)?new Error("Array is Immutable"):new Error("Invalid Parameter");if(g(i)===!1)throw new Error("Feature accessor must be a string");if(o.hasField(i)===!0)o.setField(i,I(a,e.operator,o.field(i),e));else{if(e.operator!=="=")throw new Error("Invalid Parameter");o.setField(i,I(a,e.operator,null,e))}}return u}const t=r.name.toLowerCase();if(n.localScope!==null&&n.localScope[t]!==void 0){const a=await c(n,e.right);return n.localScope[t]={value:I(a,e.operator,n.localScope[t].value,e),valueset:!0,node:e.right},u}if(n.globalScope[t]!==void 0){const a=await c(n,e.right);return n.globalScope[t]={value:I(a,e.operator,n.globalScope[t].value,e),valueset:!0,node:e.right},u}throw new Error("Cannot assign undeclared variable")}async function Qe(n,e){if(e.expression.type==="AssignmentExpression")return c(n,e.expression);if(e.expression.type==="CallExpression"){const t=await c(n,e.expression);return t===u?u:new D(t)}const r=await c(n,e.expression);return r===u?u:new D(r)}async function Xe(n,e){if(e.test.type==="AssignmentExpression"||e.test.type==="UpdateExpression")throw new Error(p(e.test,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));const r=await c(n,e.test);if(r===!0)return c(n,e.consequent);if(r===!1)return e.alternate!==null?c(n,e.alternate):u;throw new Error(p(e.test,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION"))}async function Je(n,e){return ce(n,e,0)}async function ce(n,e,r){if(r>=e.body.length)return u;const t=await c(n,e.body[r]);return t instanceof m||t===S||t===_||r===e.body.length-1?t:ce(n,e,r+1)}async function Ke(n,e){if(e.argument===null)return new m(u);const r=await c(n,e.argument);return new m(r)}async function $e(n,e){const r=e.id.name.toLowerCase();return n.globalScope[r]={valueset:!0,node:null,value:new L(e,n)},u}async function le(n,e,r){return r>=e.declarations.length?u:(await c(n,e.declarations[r]),r===e.declarations.length-1||await le(n,e,r+1),u)}async function en(n,e){let r=null;if(r=e.init===null?null:await c(n,e.init),n.localScope!==null){if(r===u&&(r=null),e.id.type!=="Identifier")throw new Error("Can only assign a regular variable");const a=e.id.name.toLowerCase();return n.localScope[a]={value:r,valueset:!0,node:e.init},u}if(e.id.type!=="Identifier")throw new Error("Can only assign a regular variable");const t=e.id.name.toLowerCase();return r===u&&(r=null),n.globalScope[t]={value:r,valueset:!0,node:e.init},u}let y=0;function te(n,e,r,t){let a;switch(e=e.toLowerCase()){case"hasz":{const o=n.hasZ;return o!==void 0&&o}case"hasm":{const o=n.hasM;return o!==void 0&&o}case"spatialreference":{let o=n.spatialReference._arcadeCacheId;if(o===void 0){let s=!0;Object.freeze&&Object.isFrozen(n.spatialReference)&&(s=!1),s&&(y++,n.spatialReference._arcadeCacheId=y,o=y)}const i=new v({wkt:n.spatialReference.wkt,wkid:n.spatialReference.wkid});return o!==void 0&&(i._arcadeCacheId="SPREF"+o.toString()),i}}switch(n.type){case"extent":switch(e){case"xmin":case"xmax":case"ymin":case"ymax":case"zmin":case"zmax":case"mmin":case"mmax":{const o=n[e];return o!==void 0?o:null}case"type":return"Extent"}break;case"polygon":switch(e){case"rings":return a=n.cache._arcadeCacheId,a===void 0&&(y++,a=y,n.cache._arcadeCacheId=a),new ee(n.rings,n.spatialReference,n.hasZ===!0,n.hasM===!0,a);case"type":return"Polygon"}break;case"point":switch(e){case"x":case"y":case"z":case"m":return n[e]!==void 0?n[e]:null;case"type":return"Point"}break;case"polyline":switch(e){case"paths":return a=n.cache._arcadeCacheId,a===void 0&&(y++,a=y,n.cache._arcadeCacheId=a),new ee(n.paths,n.spatialReference,n.hasZ===!0,n.hasM===!0,a);case"type":return"Polyline"}break;case"multipoint":switch(e){case"points":return a=n.cache._arcadeCacheId,a===void 0&&(y++,a=y,n.cache._arcadeCacheId=a),new xe(n.points,n.spatialReference,n.hasZ===!0,n.hasM===!0,a,1);case"type":return"Multipoint"}}throw new Error(p(t,"RUNTIME","PROPERTYNOTFOUND"))}async function nn(n,e){const r=await c(n,e.object);if(r===null)throw new Error(p(e,"RUNTIME","NOTFOUND"));if(e.computed===!1){if(e.property.type==="Identifier"){if(r instanceof v||U(r))return r.field(e.property.name);if(r instanceof $)return te(r,e.property.name,n,e);throw new Error(p(e,"RUNTIME","INVALIDTYPE"))}throw new Error(p(e,"RUNTIME","INVALIDTYPE"))}let t=await c(n,e.property);if(r instanceof v||U(r)){if(g(t))return r.field(t);throw new Error(p(e,"RUNTIME","INVALIDTYPE"))}if(r instanceof $){if(g(t))return te(r,t,n,e);throw new Error(p(e,"RUNTIME","INVALIDTYPE"))}if(C(r)){if(O(t)&&isFinite(t)&&Math.floor(t)===t){if(t<0&&(t=r.length+t),t>=r.length||t<0)throw new Error(p(e,"RUNTIME","OUTOFBOUNDS"));return r[t]}throw new Error(p(e,"RUNTIME","INVALIDTYPE"))}if(x(r)){if(O(t)&&isFinite(t)&&Math.floor(t)===t){if(t<0&&(t=r.length()+t),t>=r.length()||t<0)throw new Error(p(e,"RUNTIME","OUTOFBOUNDS"));return r.get(t)}throw new Error(p(e,"RUNTIME","INVALIDTYPE"))}if(g(r)){if(O(t)&&isFinite(t)&&Math.floor(t)===t){if(t<0&&(t=r.length+t),t>=r.length||t<0)throw new Error(p(e,"RUNTIME","OUTOFBOUNDS"));return r[t]}throw new Error(p(e,"RUNTIME","INVALIDTYPE"))}throw new Error(p(e,"RUNTIME","INVALIDTYPE"))}async function rn(n,e){const r=await c(n,e.argument);if(T(r)){if(e.operator==="!")return!r;if(e.operator==="-")return-1*w(r);if(e.operator==="+")return 1*w(r);if(e.operator==="~")return~w(r);throw new Error(p(e,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"))}if(e.operator==="-")return-1*w(r);if(e.operator==="+")return 1*w(r);if(e.operator==="~")return~w(r);throw new Error(p(e,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"))}async function tn(n,e){const r=[];for(let t=0;t<e.elements.length;t++)r.push(await c(n,e.elements[t]));for(let t=0;t<r.length;t++){if(j(r[t]))throw new Error(p(e,"RUNTIME","FUNCTIONCONTEXTILLEGAL"));r[t]===u&&(r[t]=null)}return r}async function an(n,e){const r=[];r[0]=await c(n,e.left),r[1]=await c(n,e.right);const t=r[0],a=r[1];switch(e.operator){case"|":case"<<":case">>":case">>>":case"^":case"&":return Ue(w(t),w(a),e.operator);case"==":return B(t,a);case"!=":return!B(t,a);case"<":case">":case"<=":case">=":return Ae(t,a,e.operator);case"+":return g(t)||g(a)?b(t)+b(a):w(t)+w(a);case"-":return w(t)-w(a);case"*":return w(t)*w(a);case"/":return w(t)/w(a);case"%":return w(t)%w(a);default:throw new Error(p(e,"RUNTIME","OPERATORNOTRECOGNISED"))}}async function on(n,e){if(e.left.type==="AssignmentExpression"||e.left.type==="UpdateExpression")throw new Error(p(e.left,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));if(e.right.type==="AssignmentExpression"||e.right.type==="UpdateExpression")throw new Error(p(e.right,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));const r=await c(n,e.left);let t=null;if(!T(r))throw new Error(p(e,"RUNTIME","ONLYBOOLEAN"));switch(e.operator){case"||":if(r===!0)return r;if(t=await c(n,e.right),T(t))return t;throw new Error(p(e,"RUNTIME","ONLYORORAND"));case"&&":if(r===!1)return r;if(t=await c(n,e.right),T(t))return t;throw new Error(p(e,"RUNTIME","ONLYORORAND"));default:throw new Error(p(e,"RUNTIME","ONLYORORAND"))}}async function Q(n,e){const r=e.name.toLowerCase();if(n.localScope!==null&&n.localScope[r]!==void 0){const t=n.localScope[r];if(t.valueset===!0)return t.value;if(t.d!==null)return t.d;t.d=c(n,t.node);const a=await t.d;return t.value=a,t.valueset=!0,a}if(n.globalScope[r]!==void 0){const t=n.globalScope[r];if(t.valueset===!0)return t.value;if(t.d!==null)return t.d;t.d=c(n,t.node);const a=await t.d;return t.value=a,t.valueset=!0,a}throw new Error(p(e,"RUNTIME","VARIABLENOTFOUND"))}async function sn(n,e){if(e.callee.type!=="Identifier")throw new Error(p(e,"RUNTIME","ONLYNODESSUPPORTED"));if(n.localScope!==null&&n.localScope[e.callee.name.toLowerCase()]!==void 0){const r=n.localScope[e.callee.name.toLowerCase()];if(r.value instanceof A)return r.value.fn(n,e);if(r.value instanceof L)return oe(n,e,r.value.definition);throw new Error(p(e,"RUNTIME","NOTAFUNCTION"))}if(n.globalScope[e.callee.name.toLowerCase()]!==void 0){const r=n.globalScope[e.callee.name.toLowerCase()];if(r.value instanceof A)return r.value.fn(n,e);if(r.value instanceof L)return oe(n,e,r.value.definition);throw new Error(p(e,"RUNTIME","NOTAFUNCTION"))}throw new Error(p(e,"RUNTIME","NOTFOUND"))}async function cn(n,e){return e.value?e.value.cooked:""}async function ln(n,e){const r=[];for(let o=0;o<e.expressions.length;o++){const i=await c(n,e.expressions[o]);r[o]=b(i)}let t="",a=0;for(const o of e.quasis)t+=o.value?o.value.cooked:"",o.tail===!1&&(t+=r[a]?r[a]:"",a++);return t}const E={};function ae(n){return n===null?"":C(n)||x(n)?"Array":Me(n)?"Date":g(n)?"String":T(n)?"Boolean":O(n)?"Number":n instanceof be?"Attachment":n instanceof Re?"Portal":n instanceof v?"Dictionary":U(n)?"Feature":n instanceof Fe?"Point":n instanceof Pe?"Polygon":n instanceof De?"Polyline":n instanceof Le?"Multipoint":n instanceof ke?"Extent":j(n)?"Function":se(n)?"FeatureSet":_e(n)?"FeatureSetCollection":n===u?"":typeof n=="number"&&isNaN(n)?"Number":"Unrecognised Type"}async function ue(n,e,r,t){const a=await c(n,e.arguments[r]);if(B(a,t))return c(n,e.arguments[r+1]);const o=e.arguments.length-r;return o===1?c(n,e.arguments[r]):o===2?null:o===3?c(n,e.arguments[r+2]):ue(n,e,r+2,t)}async function fe(n,e,r,t){if(t===!0)return c(n,e.arguments[r+1]);if(e.arguments.length-r===3)return c(n,e.arguments[r+2]);const a=await c(n,e.arguments[r+2]);if(T(a)===!1)throw new Error("WHEN needs boolean test conditions");return fe(n,e,r+2,a)}async function W(n,e){const r=n.length,t=Math.floor(r/2);if(r===0)return[];if(r===1)return[n[0]];const a=[W(n.slice(0,t),e),W(n.slice(t,r),e)],o=await Promise.all(a);return P(o[0],o[1],e,[])}async function P(n,e,r,t){const a=t;if(!(n.length>0||e.length>0))return t;if(n.length>0&&e.length>0){let o=await r(n[0],e[0]);return isNaN(o)&&(o=1),o<=0?(a.push(n[0]),n=n.slice(1)):(a.push(e[0]),e=e.slice(1)),P(n,e,r,t)}return n.length>0?(a.push(n[0]),P(n=n.slice(1),e,r,t)):e.length>0?(a.push(e[0]),P(n,e=e.slice(1),r,t)):void 0}function R(n,e){const r=n.length,t=Math.floor(r/2);return e||(e=function(a,o){return a<o?-1:a===o?0:1}),r===0?[]:r===1?[n[0]]:un(R(n.slice(0,t),e),R(n.slice(t,r),e),e)}function un(n,e,r){const t=[];for(;n.length>0||e.length>0;)if(n.length>0&&e.length>0){let a=r(n[0],e[0]);isNaN(a)&&(a=1),a<=0?(t.push(n[0]),n=n.slice(1)):(t.push(e[0]),e=e.slice(1))}else n.length>0?(t.push(n[0]),n=n.slice(1)):e.length>0&&(t.push(e[0]),e=e.slice(1));return t}async function pe(n,e,r){const t=n.body;if(r.length!==n.params.length)throw new Error("Invalid Parameter calls to function.");for(let o=0;o<r.length;o++){const i=n.params[o];i.type==="Identifier"&&(e.localScope[i.name.toLowerCase()]={d:null,value:r[o],valueset:!0,node:null})}const a=await c(e,t);if(a instanceof m)return a.value;if(a===S)throw new Error("Cannot Break from a Function");if(a===_)throw new Error("Cannot Continue from a Function");return a instanceof D?a.value:a}function oe(n,e,r){return F(n,e,function(t,a,o){const i={spatialReference:n.spatialReference,services:n.services,console:n.console,lrucache:n.lrucache,interceptor:n.interceptor,localScope:{},abortSignal:n.abortSignal,globalScope:n.globalScope,depthCounter:n.depthCounter+1};if(i.depthCounter>64)throw new Error("Exceeded maximum function depth");return pe(r,i,o)})}function X(n){return function(){const r={abortSignal:n.context.abortSignal,spatialReference:n.context.spatialReference,console:n.context.console,lrucache:n.context.lrucache,interceptor:n.context.interceptor,services:n.context.services,localScope:{},globalScope:n.context.globalScope,depthCounter:n.context.depthCounter+1};if(r.depthCounter>64)throw new Error("Exceeded maximum function depth");return pe(n.definition,r,arguments)}}we(E,N),he(E,N),de(E,N),Ee(E,N),ge(E,N),je({functions:E,compiled:!1,signatures:null,evaluateIdentifier:null,arcadeCustomFunctionHandler:null,mode:"async",standardFunction:N,standardFunctionAsync:F}),E.typeof=function(n,e){return N(n,e,function(r,t,a){V(a,1,1);const o=ae(a[0]);if(o==="Unrecognised Type")throw new Error("Unrecognised Type");return o})},E.iif=async function(n,e){V(e.arguments===null?[]:e.arguments,3,3);const r=await c(n,e.arguments[0]);if(T(r)===!1)throw new Error("IF Function must have a boolean test condition");const t=[];return t[0]=await c(n,e.arguments[1]),t[1]=await c(n,e.arguments[2]),r?t[0]:t[1]},E.decode=async function(n,e){if(e.arguments.length<2)throw new Error("Missing Parameters");if(e.arguments.length===2)return c(n,e.arguments[1]);if((e.arguments.length-1)%2==0)throw new Error("Must have a default value result.");return ue(n,e,1,await c(n,e.arguments[0]))},E.when=async function(n,e){if(e.arguments.length<3)throw new Error("Missing Parameters");if(e.arguments.length%2==0)throw new Error("Must have a default value result.");const r=await c(n,e.arguments[0]);if(T(r)===!1)throw new Error("WHEN needs boolean test conditions");return fe(n,e,0,r)},E.sort=function(n,e){return F(n,e,async function(r,t,a){V(a,1,2);let o=a[0];if(x(o)&&(o=o.toArray()),C(o)===!1)throw new Error("Illegal Argument");if(a.length>1){if(j(a[1])===!1)throw new Error("Illegal Argument");return W(o,X(a[1]))}let i=o;if(i.length===0)return[];const s={};for(let h=0;h<i.length;h++){const d=ae(i[h]);d!==""&&(s[d]=!0)}if(s.Array===!0||s.Dictionary===!0||s.Feature===!0||s.Point===!0||s.Polygon===!0||s.Polyline===!0||s.Multipoint===!0||s.Extent===!0||s.Function===!0)return i.slice(0);let l=0,f="";for(const h in s)l++,f=h;return l>1||f==="String"?i=R(i,function(h,d){if(h==null||h===u)return d==null||d===u?0:1;if(d==null||d===u)return-1;const J=b(h),K=b(d);return J<K?-1:J===K?0:1}):f==="Number"?i=R(i,function(h,d){return h-d}):f==="Boolean"?i=R(i,function(h,d){return h===d?0:d?-1:1}):f==="Date"&&(i=R(i,function(h,d){return d-h})),i})};const fn={fixSpatialReference:Ce,parseArguments:Z,standardFunction:N,standardFunctionAsync:F,evaluateIdentifier:Q,arcadeCustomFunction:X};for(const n in E)E[n]={value:new A(E[n]),valueset:!0,node:null};const M=function(){};function pn(n,e){const r=new M;n==null&&(n={}),e==null&&(e={});const t=new v({newline:`
`,tab:"	",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});t.immutable=!1,r.textformatting={value:t,valueset:!0,node:null};for(const a in e)r[a]={value:new A(e[a]),native:!0,valueset:!0,node:null};for(const a in n)n[a]&&n[a].declaredClass==="esri.Graphic"?r[a]={value:ie.createFromGraphic(n[a]),valueset:!0,node:null}:r[a]={value:n[a],valueset:!0,node:null};return r}function wn(n){console.log(n)}M.prototype=E,M.prototype.infinity={value:Number.POSITIVE_INFINITY,valueset:!0,node:null},M.prototype.pi={value:Math.PI,valueset:!0,node:null};const yn=fn;function hn(n){const e={mode:"async",compiled:!1,functions:{},signatures:[],standardFunction:N,standardFunctionAsync:F,evaluateIdentifier:Q,arcadeCustomFunctionHandler:X};for(let r=0;r<n.length;r++)n[r].registerFunctions(e);for(const r in e.functions)E[r]={value:new A(e.functions[r]),valueset:!0,node:null},M.prototype[r]=E[r];for(let r=0;r<e.signatures.length;r++)me(e.signatures[r],"async")}async function Nn(n,e){let r=e.spatialReference;r==null&&(r=new Oe({wkid:102100}));const t=pn(e.vars,e.customfunctions),a={spatialReference:r,services:e.services,abortSignal:e.abortSignal===void 0||e.abortSignal===null?{aborted:!1}:e.abortSignal,globalScope:t,console:e.console?e.console:wn,lrucache:e.lrucache,interceptor:e.interceptor,localScope:null,depthCounter:1};let o=await c(a,n.body[0].body);if(o instanceof m&&(o=o.value),o instanceof D&&(o=o.value),o===u&&(o=null),o===S)throw new Error("Cannot return BREAK");if(o===_)throw new Error("Cannot return CONTINUE");if(o instanceof A)throw new Error("Cannot return FUNCTION");if(o instanceof L)throw new Error("Cannot return FUNCTION");return o}function vn(n,e){return ye(n)}function In(n,e){return Ne(n,e,"full")}function Tn(n,e){return ve(n,e)}function Sn(n,e){return Ie(n,e)}function bn(n){return Te(n)}hn([Se]);export{Nn as executeScript,hn as extend,vn as extractFieldLiterals,bn as findFunctionCalls,yn as functionHelper,Sn as referencesFunction,Tn as referencesMember,In as validateScript};
