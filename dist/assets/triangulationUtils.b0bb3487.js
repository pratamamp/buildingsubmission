import{x as I}from"./earcut.d30cbec0.js";import{ir as L}from"./index.52935b46.js";import{n as m}from"./deduplicate.ee0b1de6.js";function W(n){const f=O(n.rings,n.hasZ,E.CCW_IS_HOLE),u=[];let t=0,o=0;for(const e of f.polygons){const c=e.count,r=e.index,y=new Float64Array(f.position.buffer,3*r*f.position.BYTES_PER_ELEMENT,3*c),p=e.holeIndices.map(h=>h-r),i=new Uint32Array(I(y,p,3));u.push({position:y,faces:i}),t+=y.length,o+=i.length}const s=x(u,t,o),g=m(s.position.buffer,6,{originalIndices:s.faces});return s.position=new Float64Array(g.buffer),s.faces=g.indices,s}function x(n,f,u){if(n.length===1)return n[0];const t=new Float64Array(f),o=new Uint32Array(u);let s=0,g=0,e=0;for(const c of n){for(let r=0;r<c.position.length;r++)t[s++]=c.position[r];for(let r=0;r<c.faces.length;r++)o[g++]=c.faces[r]+e;e=s/3}return{position:t,faces:o}}function O(n,f,u){const t=n.length,o=new Array(t),s=new Array(t),g=new Array(t);let e=0,c=0,r=0,y=0;for(let h=0;h<t;++h)y+=n[h].length;const p=new Float64Array(3*y);let i=0;for(let h=t-1;h>=0;h--){const l=n[h],_=u===E.CCW_IS_HOLE&&N(l);if(_&&t!==1)o[e++]=l;else{let C=l.length;for(let a=0;a<e;++a)C+=o[a].length;const w={index:i,pathLengths:new Array(e+1),count:C,holeIndices:new Array(e)};w.pathLengths[0]=l.length,l.length>0&&(g[r++]={index:i,count:l.length}),i=_?A(l,l.length-1,-1,p,i,l.length,f):A(l,0,1,p,i,l.length,f);for(let a=0;a<e;++a){const d=o[a];w.holeIndices[a]=i,w.pathLengths[a+1]=d.length,d.length>0&&(g[r++]={index:i,count:d.length}),i=A(d,0,1,p,i,d.length,f)}e=0,w.count>0&&(s[c++]=w)}}for(let h=0;h<e;++h){const l=o[h];l.length>0&&(g[r++]={index:i,count:l.length}),i=A(l,0,1,p,i,l.length,f)}return c<t&&(s.length=c),r<t&&(g.length=r),{position:p,polygons:s,outlines:g}}function A(n,f,u,t,o,s,g){o*=3;for(let e=0;e<s;++e){const c=n[f];t[o++]=c[0],t[o++]=c[1],t[o++]=g?c[2]:0,f+=u}return o/3}function N(n){return!L(n,!1,!1)}var E;(function(n){n[n.NONE=0]="NONE",n[n.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(E||(E={}));export{E as c,O as l,W as o};
