import{rM as C,uq as S,ur as x,rG as D,eo as I}from"./index.ce207a0f.js";import{CIMSymbolRasterizer as v}from"./CIMSymbolRasterizer.fc491b5d.js";import"./cimAnalyzer.f3fa7790.js";import"./CIMSymbolHelper.196421e9.js";import"./BidiEngine.ec67919b.js";import"./enums.05a6ea95.js";import"./alignmentUtils.63b4d661.js";import"./definitions.8fc39ccc.js";import"./number.08b65821.js";import"./GeometryUtils.814cb798.js";import"./Rasterizer.e0bc5f3d.js";const V=new v(null,!0),O=C.maxSize;async function T(t,e={}){const{size:m,maxSize:u,node:y,opacity:h}=e,g=e.cimOptions||e,{feature:w,fieldMap:M,geometryType:b,style:z}=g,f=S(t),d=typeof m=="number"?m:null,i=Math.min(d!=null?d:f,u!=null?u:I(O));i!==f&&(t=t.clone(),x(t,i,{preserveOutlineWidth:!0}));let n=3;t&&t.data&&t.data.symbol&&t.data.symbol.type!=="CIMPointSymbol"&&(n=1);const c=await V.rasterizeCIMSymbolAsync(t,w,M,b,{scaleFactor:n,style:z}),l=document.createElement("canvas");l.width=c.imageData.width,l.height=c.imageData.height,l.getContext("2d").putImageData(c.imageData,0,0);let a=l.width/n,r=l.height/n;if(m!=null&&((e==null?void 0:e.scale)==null||(e==null?void 0:e.scale))){const o=a/r;a=o<=1?Math.ceil(i*o):i,r=o<=1?i:Math.ceil(i/o)}const s=new Image(a,r);s.src=l.toDataURL(),h!=null&&(s.style.opacity=`${h}`);let p=s;if(e.effectView!=null){const o={shape:{type:"image",x:0,y:0,width:a,height:r,src:s.src},fill:null,stroke:null,offset:[0,0]};p=D([[o]],[a,r],{effectView:e.effectView})}return y&&y.appendChild(p),p}export{T as previewCIMSymbol};
