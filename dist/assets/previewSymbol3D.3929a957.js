import{rM as $,ai as B,s5 as J,s6 as P,s7 as K,bu as N,cT as w,s as A,w as S,s8 as Q,E as V,rG as W,rn as X,s9 as Y,sa as _,l as M,sb as G,sc as ss,r9 as as,ln as es,sd as ts,se as rs,sf as ns,sg as ls,sh as os,si as is,sj as cs,sk as ps,sl as I,sm as hs}from"./index.ce207a0f.js";import{resolveWebStyleSymbol as us}from"./webStyleSymbolUtils.f59435ea.js";const L=$.size,D=$.maxSize,Z=$.maxOutlineSize,F=$.lineWidth,R=$.tallSymbolWidth,ms=B.getLogger("esri.symbols.support.previewSymbol3D");function z(s){const a=s.outline,r=M(s.material)?s.material.color:null,e=M(r)?r.toHex():null;if(S(a)||"pattern"in a&&M(a.pattern)&&a.pattern.type==="style"&&a.pattern.style==="none")return s.type==="fill"&&e==="#ffffff"?{color:"#bdc3c7",width:.75}:null;const t=w(a.size)||0;return{color:"rgba("+(M(a.color)?a.color.toRgba():"255,255,255,1")+")",width:Math.min(t,Z),style:"pattern"in a&&M(a.pattern)&&a.pattern.type==="style"?G(a.pattern.style):null,join:"butt",cap:"patternCap"in a?a.patternCap:"butt"}}function fs(s,a){const r=a&&a.resource,e=r&&r.href;if(s.thumbnail&&s.thumbnail.url)return Promise.resolve(s.thumbnail.url);if(e&&a.type!=="object")return Promise.resolve(ss(s,a));const t=N("esri/images/Legend/legend3dsymboldefault.png");return s.styleOrigin&&(s.styleOrigin.styleName||s.styleOrigin.styleUrl)?us(s.styleOrigin,{portal:s.styleOrigin.portal},"webRef").catch(n=>n).then(n=>{var l;return((l=n==null?void 0:n.thumbnail)==null?void 0:l.url)||t}):Promise.resolve(t)}function E(s,a=1){const r=s.a,e=as(s),t=e.h,n=e.s/a,l=100-(100-e.v)/a,{r:p,g:y,b:u}=es({h:t,s:n,v:l});return[p,y,u,r]}function C(s){return s.type==="water"?S(s.color)?null:s.color:S(s.material)||S(s.material.color)?null:s.material.color}function i(s,a=0){const r=C(s);if(!r){if(s.type==="fill")return null;const t=J.r,n=P(t,a);return[n,n,n,100]}const e=r.toRgba();for(let t=0;t<3;t++)e[t]=P(e[t],a);return e}async function ys(s,a){const r=s.style;return r==="none"?null:{type:"pattern",x:0,y:0,src:await K(N(`esri/symbols/patterns/${r}.png`),a.toCss(!0)),width:5,height:5}}function H(s){return s.outline?z(s):{color:"rgba(0, 0, 0, 1)",width:1.5}}function U(s,a){const r=C(s);if(!r)return null;let e="rgba(";return e+=P(r.r,a)+",",e+=P(r.g,a)+",",e+=P(r.b,a)+",",e+r.a+");"}function T(s,a){const r=U(s,a);return r?"pattern"in s&&M(s.pattern)&&s.pattern.type==="style"&&s.pattern.style==="none"?null:{color:r,width:Math.min(s.size?w(s.size):.75,Z),style:"pattern"in s&&M(s.pattern)&&s.pattern.type==="style"?G(s.pattern.style):null,cap:"cap"in s?s.cap:null,join:"join"in s?s.join==="miter"?w(2):s.join:null}:{}}function O(s,a,r){const e=.75*r;return{type:"linear",x1:e?.25*e:0,y1:e?.5*e:0,x2:e||4,y2:e?.5*e:4,colors:[{color:s,offset:0},{color:a,offset:1}]}}function ds(s){const a=s.depth,r=s.height,e=s.width;return e&&a&&r&&e===a&&e<r}function bs(s,a,r){const e=[];if(!s)return e;switch(s.type){case"icon":{const l=a,p=a;switch(s.resource&&s.resource.primitive||ps){case"circle":e.push({shape:{type:"circle",cx:0,cy:0,r:.5*a},fill:i(s,0),stroke:z(s)});break;case"square":e.push({shape:{type:"path",path:[{command:"M",values:[0,p]},{command:"L",values:[0,0]},{command:"L",values:[l,0]},{command:"L",values:[l,p]},{command:"Z",values:[]}]},fill:i(s,0),stroke:z(s)});break;case"triangle":e.push({shape:{type:"path",path:[{command:"M",values:[0,p]},{command:"L",values:[.5*l,0]},{command:"L",values:[l,p]},{command:"Z",values:[]}]},fill:i(s,0),stroke:z(s)});break;case"cross":e.push({shape:{type:"path",path:[{command:"M",values:[.5*l,0]},{command:"L",values:[.5*l,p]},{command:"M",values:[0,.5*p]},{command:"L",values:[l,.5*p]}]},stroke:H(s)});break;case"x":e.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[l,p]},{command:"M",values:[l,0]},{command:"L",values:[0,p]}]},stroke:H(s)});break;case"kite":e.push({shape:{type:"path",path:[{command:"M",values:[0,.5*p]},{command:"L",values:[.5*l,0]},{command:"L",values:[l,.5*p]},{command:"L",values:[.5*l,p]},{command:"Z",values:[]}]},fill:i(s,0),stroke:z(s)})}break}case"object":switch(s.resource&&s.resource.primitive||ts){case"cone":{const t=O(i(s,0),i(s,-.6),r?R:a),n=cs(a,r);e.push({shape:n[0],fill:t}),e.push({shape:n[1],fill:t});break}case"inverted-cone":{const t=i(s,0),n=O(t,i(s,-.6),a),l=is(a);e.push({shape:l[0],fill:n}),e.push({shape:l[1],fill:t});break}case"cube":{const t=os(a,r);e.push({shape:t[0],fill:i(s,0)}),e.push({shape:t[1],fill:i(s,-.3)}),e.push({shape:t[2],fill:i(s,-.5)});break}case"cylinder":{const t=O(i(s,0),i(s,-.6),r?R:a),n=ls(a,r);e.push({shape:n[0],fill:t}),e.push({shape:n[1],fill:t}),e.push({shape:n[2],fill:i(s,0)});break}case"diamond":{const t=ns(a);e.push({shape:t[0],fill:i(s,-.3)}),e.push({shape:t[1],fill:i(s,0)}),e.push({shape:t[2],fill:i(s,-.3)}),e.push({shape:t[3],fill:i(s,-.7)});break}case"sphere":{const t=O(i(s,0),i(s,-.6));t.x1=0,t.y1=0,t.x2=.25*a,t.y2=.25*a,e.push({shape:{type:"circle",cx:0,cy:0,r:.5*a},fill:t});break}case"tetrahedron":{const t=rs(a);e.push({shape:t[0],fill:i(s,-.3)}),e.push({shape:t[1],fill:i(s,0)}),e.push({shape:t[2],fill:i(s,-.6)});break}}break}return e}function q(s){const a=typeof(s==null?void 0:s.size)=="number"?s==null?void 0:s.size:null;return a?w(a):null}function gs(s){return s.type==="icon"?"multiply":"tint"}function vs(s,a){const r=q(a),e=a&&a.maxSize?w(a.maxSize):null,t=a&&a.disableUpsampling,n=s.symbolLayers,l=[];let p=0,y=0;const u=n.getItemAt(n.length-1);let d;return u&&u.type==="icon"&&(d=u.size&&w(u.size)),n.forEach(f=>{var k;if(f.type!=="icon"&&f.type!=="object")return;const c=f.type==="icon"?f.size&&w(f.size):0,h=r||c?Math.ceil(Math.min(r||c,e||D)):L;if(f&&f.resource&&f.resource.href){const o=fs(s,f).then(m=>{const b=f.get("material.color"),g=gs(f);return Q(m,h,b,g,t)}).then(m=>{const b=m.width,g=m.height;return p=Math.max(p,b),y=Math.max(y,g),[{shape:{type:"image",x:0,y:0,width:b,height:g,src:m.url},fill:null,stroke:null}]});l.push(o)}else{let o=h;f.type==="icon"&&d&&r&&(o=h*(c/d));const m=(a==null?void 0:a.symbolConfig)==="tall"||((k=a==null?void 0:a.symbolConfig)==null?void 0:k.isTall)||f.type==="object"&&ds(f);p=Math.max(p,m?R:o),y=Math.max(y,o),l.push(Promise.resolve(bs(f,o,m)))}}),V(l).then(f=>{const c=[];return f.forEach(h=>{h.value?c.push(h.value):h.error&&ms.warn("error while building swatchInfo!",h.error)}),W(c,[p,y],{node:a&&a.node,scale:!1,opacity:a&&a.opacity})})}function ks(s,a){const r=s.symbolLayers,e=[],t=X(s),n=q(a),l=(a&&a.maxSize?w(a.maxSize):null)||Z;let p,y=0,u=0;return r.forEach((d,f)=>{if(!d||d.type!=="line"&&d.type!=="path")return;const c=[];switch(d.type){case"line":{const h=T(d,0);if(S(h))break;const k=h&&h.width||0;f===0&&(p=k);const o=Math.min(n||k,l),m=f===0?o:n?o*(k/p):o,b=m>F/2?2*m:F;u=Math.max(u,m),y=Math.max(y,b),h.width=m,c.push({shape:{type:"path",path:[{command:"M",values:[0,.5*u]},{command:"L",values:[y,.5*u]}]},stroke:h});break}case"path":{const h=Math.min(n||L,l),k=i(d,0),o=i(d,-.2),m=U(d,-.4),b=m?{color:m,width:1}:{};if(d.profile==="quad"){const g=d.width,v=d.height,x=Y(g&&v?g/v:1,v===0,g===0),j={...b,join:"bevel"};c.push({shape:x[0],fill:o,stroke:j}),c.push({shape:x[1],fill:o,stroke:j}),c.push({shape:x[2],fill:k,stroke:j})}else c.push({shape:I.pathSymbol3DLayer[0],fill:o,stroke:b}),c.push({shape:I.pathSymbol3DLayer[1],fill:k,stroke:b});u=Math.max(u,h),y=u}}e.push(c)}),Promise.resolve(W(e,[y,u],{node:a&&a.node,scale:t,opacity:a&&a.opacity}))}async function ws(s,a){const r=s.type==="mesh-3d",e=s.symbolLayers,t=q(a),n=a&&a.maxSize?w(a.maxSize):null,l=t||L,p=[];let y=0,u=0,d=!1;for(let f=0;f<e.length;f++){const c=e.getItemAt(f),h=[];if(r&&c.type!=="fill")continue;const k=I.fill[0];switch(c.type){case"fill":{const o=z(c),m=Math.min(l,n||D);y=Math.max(y,m),u=Math.max(u,m),d=!0;let b=i(c,0);const g="pattern"in c&&c.pattern,v=C(c);!r&&M(g)&&g.type==="style"&&g.style!=="solid"&&v&&(b=await ys(g,v)),h.push({shape:k,fill:b,stroke:o});break}case"line":{const o=T(c,0);if(S(o))break;const m={stroke:o,shape:k};y=Math.max(y,L),u=Math.max(u,L),h.push(m);break}case"extrude":{const o={join:"round",width:1,...T(c,-.4)},m=i(c,0),b=i(c,-.2),g=Math.min(l,n||D),v=_(g);o.width=1,h.push({shape:v[0],fill:b,stroke:o}),h.push({shape:v[1],fill:b,stroke:o}),h.push({shape:v[2],fill:m,stroke:o});const x=L,j=.7*L+.5*g;y=Math.max(y,x),u=Math.max(u,j);break}case"water":{const o=C(c),m=E(o),b=E(o,2),g=E(o,3),v=hs();d=!0,h.push({shape:v[0],fill:m}),h.push({shape:v[1],fill:b}),h.push({shape:v[2],fill:g});const x=Math.min(l,n||D);y=Math.max(y,x),u=Math.max(u,x);break}}p.push(h)}return W(p,[y,u],{node:a&&a.node,scale:d,opacity:a&&a.opacity})}function Ls(s,a){if(s.symbolLayers.length===0)return Promise.reject(new A("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));switch(s.type){case"point-3d":return vs(s,a);case"line-3d":return ks(s,a);case"polygon-3d":case"mesh-3d":return ws(s,a)}return Promise.reject(new A("symbolPreview: swatchInfo3D","symbol not supported."))}export{ys as getPatternDescriptor,q as getSizeFromOptions,i as getSymbolLayerFill,Ls as previewSymbol3D};
