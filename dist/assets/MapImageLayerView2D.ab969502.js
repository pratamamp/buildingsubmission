import{ai as d,pN as g,H as l,I as p,g1 as c,e as a,g as m,n as u}from"./index.deeeec5f.js";import{t as f}from"./BitmapContainer.17933f85.js";import{f as v}from"./LayerView2D.8d224f69.js";import{a as y}from"./BaseGraphicContainer.30b6abe2.js";import{n as w}from"./HighlightGraphicContainer.c04cf1ad.js";import{S as x}from"./ExportStrategy.a2da4dd7.js";import{u as q}from"./LayerView.01f05af6.js";import{x as C}from"./MapImageLayerView.7a5de3bf.js";import{i as U}from"./RefreshableLayerView.92abe7be.js";import"./brushes.cdb6e6bc.js";import"./pixelUtils.c2c7174c.js";import"./definitions.8fc39ccc.js";import"./Utils.6b087bd2.js";import"./number.08b65821.js";import"./enums.05a6ea95.js";import"./ProgramTemplate.44aa5358.js";import"./MaterialKey.27dab64d.js";import"./alignmentUtils.63b4d661.js";import"./utils.fbbc4a0f.js";import"./StyleDefinition.5774ff26.js";import"./GeometryUtils.8166011b.js";import"./WGLContainer.f52f7b24.js";import"./Container.de644bec.js";import"./EffectView.b3326d65.js";import"./CIMSymbolHelper.2bc40e2c.js";import"./BidiEngine.ec67919b.js";import"./GeometryUtils.814cb798.js";import"./normalizeUtilsSync.ca8a8b3b.js";import"./FeatureContainer.3c56815a.js";import"./visualVariablesUtils.d326aebf.js";import"./visualVariablesUtils.2bf407d6.js";import"./TileContainer.6a572bcb.js";import"./Matcher.2e134730.js";import"./tileUtils.82ba7e93.js";import"./TileClipper.f6e92305.js";import"./Geometry.b68345ae.js";import"./cimAnalyzer.7a950ffb.js";import"./ExpandedCIM.2d2ac98b.js";import"./schemaUtils.7579904c.js";import"./createSymbolSchema.e77457a9.js";import"./MD5.97b39efc.js";import"./util.eeacce14.js";import"./ComputedAttributeStorage.61fc89b2.js";import"./centroid.6defcca4.js";import"./GraphicsView.e25f5bad.js";import"./Bitmap.b3f0942b.js";import"./ExportImageParameters.0973eb2c.js";import"./floorFilterUtils.69500d62.js";import"./sublayerUtils.e7bab401.js";import"./popupUtils.06b99c9e.js";const I=d.getLogger("esri.views.2d.layers.MapImageLayerView2D");let i=class extends C(U(v(q))){constructor(){super(...arguments),this._highlightGraphics=new g}update(t){this.strategy.update(t).catch(e=>{l(e)||I.error(e)})}attach(){const{imageMaxWidth:t,imageMaxHeight:e,version:r}=this.layer,o=r>=10.3,h=r>=10;this._bitmapContainer=new f,this.container.addChild(this._bitmapContainer);const n=new y({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new w(this.view.featuresTilingScheme)});this.container.addChild(n.container),this.strategy=new x({container:this._bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:t,imageMaxHeight:e,imageRotationSupported:o,imageNormalizationSupported:h,hidpi:!0}),this.handles.add(p(()=>this.exportImageVersion,()=>this.requestUpdate()),"exportImageVersion"),this.handles.add(p(()=>{var s;return(s=this.view)==null?void 0:s.floors},()=>this.requestUpdate()),"view.floors"),this.requestUpdate()}detach(){this.handles.remove("exportImageVersion"),this.handles.remove("view.floors"),this.strategy.destroy(),this.container.removeAllChildren(),this._bitmapContainer.removeAllChildren()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}highlight(t,e){return this._highlightGraphics.add(t),{remove:()=>{this._highlightGraphics.remove(t)}}}supportsSpatialReference(t){return this.layer.serviceSupportsSpatialReference(t)}createFetchPopupFeaturesQueryGeometry(t,e){return c(t,e,this.view)}async doRefresh(){this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(t,e,r,o){return this.layer.fetchImage(t,e,r,{timeExtent:this.timeExtent,floors:this.view.floors,...o})}};a([m()],i.prototype,"strategy",void 0),a([m()],i.prototype,"updating",void 0),i=a([u("esri.views.2d.layers.MapImageLayerView2D")],i);const qt=i;export{qt as default};
