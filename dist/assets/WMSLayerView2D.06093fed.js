import{ai as I,H as R,I as q,aw as U,e as h,g as f,n as V}from"./index.ce207a0f.js";import{t as W}from"./BitmapContainer.73ff1b01.js";import{f as E}from"./LayerView2D.1f6652ae.js";import{S as H}from"./ExportStrategy.9193a0b8.js";import{u as L}from"./LayerView.77dd4a59.js";import{i as b}from"./RefreshableLayerView.1651caec.js";import{a as C}from"./WMSLayerView.5a89a06c.js";import"./brushes.f31c87da.js";import"./pixelUtils.ec04186c.js";import"./definitions.8fc39ccc.js";import"./Utils.7465a4f2.js";import"./number.08b65821.js";import"./enums.05a6ea95.js";import"./ProgramTemplate.5b362e40.js";import"./MaterialKey.861b2374.js";import"./alignmentUtils.63b4d661.js";import"./utils.124a4cde.js";import"./StyleDefinition.5774ff26.js";import"./GeometryUtils.8166011b.js";import"./WGLContainer.0d46658c.js";import"./Container.cfcf6621.js";import"./EffectView.c88a4e0d.js";import"./Bitmap.dca52ae6.js";import"./ExportWMSImageParameters.ebe5944b.js";const D=I.getLogger("esri.views.2d.layers.WMSLayerView2D");let o=class extends C(b(E(L))){constructor(){super(...arguments),this.container=new W}supportsSpatialReference(t){return this.layer.serviceSupportsSpatialReference(t)}update(t){this.strategy.update(t).catch(e=>{R(e)||D.error(e)})}attach(){const{layer:t,container:e}=this,{imageMaxHeight:a,imageMaxWidth:r}=t;this.strategy=new H({container:e,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxHeight:a,imageMaxWidth:r,imageRotationSupported:!1,imageNormalizationSupported:!1,hidpi:!1}),this.handles.add(q(()=>this.exportImageVersion,()=>this.requestUpdate()),"exportImageVersion")}detach(){this.handles.remove("exportImageVersion"),this.strategy.destroy(),this.strategy=null,this.container.removeAllChildren()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}createFetchPopupFeaturesQuery(t){const{view:e,container:a}=this,{x:r,y:s}=t,{spatialReference:w}=e;let i=null,n=0,d=0;if(a.children.some(M=>{const{width:c,height:g,resolution:l,x:p,y:m}=M,y=p+l*c,x=m-l*g;return r>=p&&r<=y&&s<=m&&s>=x&&(i=new U({xmin:p,ymin:x,xmax:y,ymax:m,spatialReference:w}),n=c,d=g,!0)}),!i)return null;const u=i.width/n,v=Math.round((r-i.xmin)/u),S=Math.round((i.ymax-s)/u);return{extent:i,width:n,height:d,x:v,y:S}}async doRefresh(){this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(t,e,a,r){return this.layer.fetchImage(t,e,a,{timeExtent:this.timeExtent,...r})}};h([f()],o.prototype,"strategy",void 0),h([f()],o.prototype,"updating",void 0),o=h([V("esri.views.2d.layers.WMSLayerView2D")],o);const ot=o;export{ot as default};
