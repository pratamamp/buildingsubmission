import{nm as te,nn as se,l$ as Y,no as ie,u as q,at as l,dq as B,fk as F,m0 as E,np as X,I as Q,l as d,g9 as L,b5 as J,aq as A,i6 as K,kC as T,m_ as $,m1 as D,hX as V,w as P,nq as re,an as g,nr as I,ns as ne,kx as ae,nt as oe,nu as le,nv as he,gb as Z,nw as x,lA as de,aW as ce,me as _e,md as ue,mQ as M,cS as pe,du as S,dp as b,k7 as v,m as y,nx as o,n8 as O,mi as fe,ny as me,nz as H}from"./index.deeeec5f.js";import{_ as ge,S as W}from"./PointVisualElement.dc8d619d.js";import{j as xe}from"./RightAngleQuadVisualElement.1e14a844.js";import{r as ye}from"./SnappingContext.59276322.js";class we extends Y{constructor(e){super(e),this._ray=ie(),this._externalResources=null,this._handles=new q,this._isWorldDown=!1,this._start=l(),this._end=B(1,0,0),this._width=1,this._color=F(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=F(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=_.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=E.OccludeAndTransparent,this._fadedExtensions=U,this.applyProps(e)}createExternalResources(){const e=new X(this.materialParameters);this._handles.add(Q(()=>this.view.state.camera,()=>{this._updateGeometry()}));const t=new ge({view:this.view,attached:this._laserlineEnabled});this._externalResources={material:e,laserline:t}}destroyExternalResources(){d(this._externalResources)&&this._externalResources.laserline.destroy(),this._externalResources=null,this._handles.removeAll()}forEachExternalMaterial(e){d(this._externalResources)&&e(this._externalResources.material)}createGeometries(e){const t=[l(),l()],s=this.extensionType===_.FADED;s&&t.push(l(),l());const i=s?new Float32Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]):null,r=L.createPolylineGeometry(t,null,i);e.addGeometry(r,J(this._externalResources).material),this._updateVertices(e)}updateVisibility(e){super.updateVisibility(e),d(this._externalResources)&&(this._externalResources.laserline.visible=e)}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,A(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),K(this._end,e,this._end),T(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,$(this._start,e)||(A(this._start,e),T(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,$(this._end,e)||(A(this._end,e),T(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){D(e,this._color)||(V(this._color,e),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){D(e,this._innerColor)||(V(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=d(e)!==d(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){(P(e)||P(this._stippleOffColor)||!D(e,this._stippleOffColor))&&(this._stippleOffColor=d(e)?re(e):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this._updateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&d(this._laserlineStyle)}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,d(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached,d(e)&&(this._externalResources.laserline.style=e))}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,d(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached))}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=g(e,U),this.recreateGeometry()}_updateMaterial(){P(this._externalResources)||this._externalResources.material.setParameters(this.materialParameters)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}_updateGeometry(){d(this.object)&&this._updateVertices(this.object)}_updateVertices(e){const t=this._extensionType===_.FADED?this._updateLineSegmentFinite(N):this._updateLineSegmentInfinite(this._extensionType,N);this._updateVertexAttributes(e,t),d(this._externalResources)&&(this._externalResources.laserline.intersectsLine=t)}_updateLineSegmentFinite(e){return I(this._start,this._end,e)}_updateLineSegmentInfinite(e,t){const s=this.view.state.camera;switch(ne(this._ray,f),e){case _.LINE:f.c0=-Number.MAX_VALUE;break;case _.RAY:case _.GROUND_RAY:{const a=this._ray.origin,n=g(this.view.elevationProvider.getElevation(a[0],a[1],a[2],this.view.renderCoordsHelper.spatialReference,"ground"),0),h=this.view.renderCoordsHelper.getAltitude(a);this._isWorldDown&&h<n&&ae(f.ray.direction,f.ray.direction),this._extensionType===_.GROUND_RAY&&n!=null&&(f.c1=Math.abs(h-n));break}}if(!oe(s.frustum,f))return I(this._start,this._end,t);const i=le(f,m),r=he(f,Ee);return I(i,r,t)}_updateVertexAttributes(e,t){const s=e.geometries[0].getMutableAttribute(Z.POSITION).data;if(this.extensionType===_.FADED){const i=x(t,-this.fadedExtensions.start,m);s[0]=i[0],s[1]=i[1],s[2]=i[2];const r=x(t,0,m);s[3]=r[0],s[4]=r[1],s[5]=r[2];const a=x(t,1,m);s[6]=a[0],s[7]=a[1],s[8]=a[2];const n=x(t,1+this.fadedExtensions.end,m);s[9]=n[0],s[10]=n[1],s[11]=n[2]}else{const i=x(t,0,m);s[0]=i[0],s[1]=i[1],s[2]=i[2];const r=x(t,1,m);s[3]=r[0],s[4]=r[1],s[5]=r[2]}e.geometryVertexAttrsUpdated(e.geometryRecords[0])}}const f=te(),m=l(),Ee=l(),N=se();var _;(function(c){c[c.LINE=0]="LINE",c[c.RAY=1]="RAY",c[c.GROUND_RAY=2]="GROUND_RAY",c[c.FADED=3]="FADED"})(_||(_={}));const z=1/3,U={start:z,end:z};class Re extends Y{constructor(e){super(e),this._handles=new q,this._location=l(),this._direction=B(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=F(1,0,1,1),this._renderOccluded=E.OccludeAndTransparent,this.applyProps(e)}get location(){return this._location}set location(e){$(this._location,e)||(A(this._location,e),this._updateGeometry())}get direction(){return this._direction}set direction(e){$(this._direction,e)||(A(this._direction,e),this._updateGeometry())}setDirectionFromPoints(e,t){de(this._direction,K(this._direction,t,e)),this._updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this._updateGeometry())}get color(){return this._color}set color(e){D(e,this._color)||(V(this._color,e),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}createExternalResources(){const e=new X(this.materialParameters);this._handles.add(Q(()=>this.view.state.camera,()=>{this._updateGeometry()})),this._externalResources={material:e}}destroyExternalResources(){this._handles.removeAll(),this._externalResources=null}createGeometries(e){const t=L.createPolylineGeometry([l(),l()]),s=L.createPolylineGeometry([l(),l()]),i=J(this._externalResources).material;e.addGeometry(t,i),e.addGeometry(s,i),this._updateVertices(e)}forEachExternalMaterial(e){d(this._externalResources)&&e(this._externalResources.material)}_updateMaterial(){P(this._externalResources)||this._externalResources.material.setParameters(this.materialParameters)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded}}_updateGeometry(){const e=this.object;P(e)||this._updateVertices(e)}_updateVertices(e){const t=this.view.state.camera;t.projectToScreen(this.location,C),ce(u,this.location,this.direction),t.projectToScreen(u,w),_e(w,ue(w,w,C)),this._updateVertexAttributes(t,e,0,C,w,1),this._updateVertexAttributes(t,e,1,C,w,-1)}_updateVertexAttributes(e,t,s,i,r,a){const n=t.geometryRecords[s],h=n.geometry.getMutableAttribute(Z.POSITION).data,p=M(j,pe(j,r[1]*a,r[0]*-a),this.offset+this.width/2),R=S(G,S(G,S(G,i,M(G,r,this.length/2)),p),p),ee=S(k,R,M(k,r,-this.length));e.unprojectFromScreen(R,u),h[0]=u[0],h[1]=u[1],h[2]=u[2],e.unprojectFromScreen(ee,u),h[3]=u[0],h[4]=u[1],h[5]=u[2],t.geometryVertexAttrsUpdated(n)}}const u=l(),C=b(),w=b(),j=b(),G=b(),k=b();class be extends ye{visualizeIntersectionPoint(e,t){const{coordinateHelper:s,view:i}=t;return v(new W({view:i,primitive:"circle",geometry:s.vectorToPoint(e.intersectionPoint),elevationInfo:g(e.elevationInfo,t.elevationInfo),size:20,outlineSize:2,color:[0,0,0,0],outlineColor:y.toUnitRGBA(o.orange),pixelSnappingEnabled:!1}))}visualizePoint(e,t){const{coordinateHelper:s,view:i}=t;return v(new W({view:i,primitive:"circle",geometry:s.vectorToPoint(e.point),elevationInfo:g(e.elevationInfo,t.elevationInfo),size:20,outlineSize:2,color:[0,0,0,0],outlineColor:y.toUnitRGBA(o.orange),pixelSnappingEnabled:!1}))}visualizeLine(e,t){const{coordinateHelper:s,view:i}=t;return v(this._createLineSegmentHintFromMap(e.type,e.lineStart,e.lineEnd,s,g(e.elevationInfo,t.elevationInfo),i,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){const{coordinateHelper:s,view:i}=t,r=g(e.elevationInfo,t.elevationInfo),a=O(e.lineStart,s,r,t.view),n=O(e.lineEnd,s,r,t.view),h=fe(n,a,n,.5),p=new Re({view:i,attached:!1,offset:o.parallelLineHintOffset,length:o.parallelLineHintLength,width:o.parallelLineHintWidth,color:y.toUnitRGBA(o.orange),location:h,renderOccluded:E.Opaque});return p.setDirectionFromPoints(a,h),p.attached=!0,v(p)}visualizeRightAngleQuad(e,t){const{coordinateHelper:s,view:i}=t,r=g(e.elevationInfo,t.elevationInfo);return v(new xe({view:i,attached:!0,color:y.toUnitRGBA(o.orange),renderOccluded:E.Transparent,outlineRenderOccluded:E.Opaque,outlineColor:y.toUnitRGBA(o.orange),outlineSize:o.rightAngleHintOutlineSize,size:o.rightAngleHintSize,geometry:{previous:O(e.previousVertex,s,r,i),center:O(e.centerVertex,s,r,i),next:O(e.nextVertex,s,r,i)}}))}_createLineSegmentHintFromMap(e,t,s,i,r,a,n=!0,h=!0){const p=l(),R=l();return me(t,s,i,r,a,p,R),this._createLineSegmentHint(e,a,p,R,n,h)}_createLineSegmentHint(e,t,s,i,r=!0,a=!0){const n=new we({view:t,extensionType:_.FADED,start:s,end:i,color:y.toUnitRGBA(o.orange),renderOccluded:E.Opaque});switch(e){case H.TARGET:n.width=o.lineHintWidthTarget,n.fadedExtensions={start:0,end:o.lineHintFadedExtensions};break;case H.REFERENCE_EXTENSION:n.width=o.lineHintWidthReference,n.fadedExtensions={start:0,end:0};break;case H.REFERENCE:n.width=o.lineHintWidthReference,n.fadedExtensions={start:r?o.lineHintFadedExtensions:0,end:a?o.lineHintFadedExtensions:0}}return n.attached=!0,n}}export{we as G,_ as V,be as g};
